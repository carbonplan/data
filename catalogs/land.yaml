plugins:
  source:
    - module: intake_xarray

sources:

  fire:
    args:
      path: "{{CATALOG_DIR}}/fire.yaml"
    description: 'CarbonPlan Fire Dataset Catalog'
    driver: intake.catalog.local.YAMLFileCatalog
    metadata: {}

  fia:
    args:
      path: "{{CATALOG_DIR}}/fia.yaml"
    description: 'CarbonPlan FIA Dataset Catalog'
    driver: intake.catalog.local.YAMLFileCatalog
    metadata: {}

  raw_nlcd_raster:
    description: NLCD Land Cover Change Index
    metadata:
      url: https://www.mrlc.gov/
      tags: [land cover, cog]
      ci: xfail  # reason: cogs are flaky
    parameters:
      option:
        description: year (int) or change
        type: str
        default: 2016
        allowed: [2001, 2004, 2006, 2008, 2011, 2013, 2016, change]
      region:
        description: conus or ak
        type: str
        default: conus
        allowed: [conus, ak]
    driver: rasterio
    args:
      urlpath: "https://storage.googleapis.com/carbonplan-data/raw/nlcd/{{ region }}/30m/{{ option }}.tif"
      chunks: {'y': 5120, 'x': 5120}

  nlcd_raster:
    description: NLCD Land Cover Change Index
    metadata:
      url: https://www.mrlc.gov/
      tags: [land cover, cog]
      ci: xfail  # reason: cogs are flaky
    parameters:
      option:
        description: year (int) or change
        type: str
        default: 2016
        allowed: [2001, 2004, 2006, 2008, 2011, 2013, 2016]  # where is "change"?
      resolution:
        description: pixel resolution in meters
        type: str
        default: 4000m
        allowed: [250m, 4000m]
      region:
        description: conus or ak
        type: str
        default: conus
        allowed: [conus, ak]
    driver: rasterio
    args:
      urlpath: "https://storage.googleapis.com/carbonplan-data/processed/nlcd/{{ region }}/{{ resolution }}/{{ option }}.tif"
      chunks: {'y': 5120, 'x': 5120}

  raw_nftd_raster:
    description: Extent, distribution, and forest type composition of the nation’s forests.
    metadata:
      url: https://data.fs.usda.gov/geodata/rastergateway/forest_type/
      tags: [land cover, cog]
      ci: xfail  # reason: cogs are flaky
    parameters:
      option:
        description: year (int) or change
        type: str
        default: raster
        allowed: [error, raster]
      region:
        description: conus or ak
        type: str
        default: conus
        allowed: [conus, ak]
      variable:
        description: foresttype or forestgroup
        type: str
        default: foresttype
        allowed: [foresttype, forestgroup]
    driver: rasterio
    args:
      urlpath: "https://storage.googleapis.com/carbonplan-data/raw/nftd/{{ region }}_{{ variable }}/250m/{{ option }}.tif"
      chunks: {'y': 5120, 'x': 5120}


  nftd_raster:
    description: Extent, distribution, and forest type composition of the nation’s forests.
    metadata:
      url: https://data.fs.usda.gov/geodata/rastergateway/forest_type/
      tags: [land cover, cog]
      ci: xfail  # reason: cogs are flaky
    parameters:
      region:
        description: conus or ak
        type: str
        default: conus
        allowed: [conus, ak]
      option:
        description: group/type [optional _error]
        type: str
        default: type
        allowed: [group, type, group_error, type_error]
      resolution:
        description: pixel resolution in meters
        type: str
        default: 4000m
        allowed: [250m, 4000m]
    driver: rasterio
    args:
      urlpath: "https://storage.googleapis.com/carbonplan-data/processed/nftd/{{ region }}/{{ resolution }}/{{ option }}.tif"
      chunks: {'y': 5120, 'x': 5120}
